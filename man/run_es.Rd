% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_es.R
\name{run_es}
\alias{run_es}
\title{Event Study Estimation for Panel Data}
\usage{
run_es(
  data,
  outcome,
  treatment,
  time,
  timing,
  fe,
  lead_range = NULL,
  lag_range = NULL,
  covariates = NULL,
  cluster = NULL,
  weights = NULL,
  baseline = -1L,
  interval = 1,
  time_transform = FALSE,
  unit = NULL,
  staggered = FALSE,
  method = c("classic", "sunab"),
  conf.level = 0.95,
  vcov = "HC1",
  vcov_args = list()
)
}
\arguments{
\item{data}{A data.frame containing panel data.}

\item{outcome}{Unquoted outcome (name or expression, e.g., \code{log(y)}).}

\item{treatment}{Unquoted treatment indicator (0/1 or logical). Used only when \code{method = "classic"}.}

\item{time}{Unquoted time variable (numeric or Date).}

\item{timing}{For \code{classic}: a numeric/Date (universal) or a variable (unquoted) if \code{staggered = TRUE}. For \code{sunab}: an unquoted variable with adoption time.}

\item{fe}{One-sided fixed-effects formula, e.g., \code{~ id + year}.}

\item{lead_range, lag_range}{Integers for pre/post windows. If \code{NULL}, determined automatically.}

\item{covariates}{One-sided formula of additional controls, e.g., \code{~ x1 + log(x2)}.}

\item{cluster}{Cluster specification (one-sided formula like \code{~ id + year}, a single character column name, or a vector of length \code{nrow(data)}).}

\item{weights}{Observation weights (a name/one-sided formula or a numeric vector of length \code{nrow(data)}).}

\item{baseline}{Integer baseline period (default \code{-1}); used only when \code{method = "classic"}.}

\item{interval}{Numeric spacing of the time variable (default \code{1}; ignored internally for Dates).}

\item{time_transform}{Logical; if \code{TRUE}, creates consecutive integer time within unit.}

\item{unit}{Unit identifier variable (required when \code{time_transform = TRUE}); also used for metadata when supplied.}

\item{staggered}{Logical; if \code{TRUE}, \code{timing} is a variable (classic) or is used by \code{sunab}.}

\item{method}{Either \code{"classic"} or \code{"sunab"} (default: \code{"classic"}).}

\item{conf.level}{Numeric vector of confidence levels (default \code{0.95}).}

\item{vcov}{VCOV type passed to \code{fixest::vcov()} or used via \code{broom::tidy(vcov = ...)}. Default \code{"HC1"}.}

\item{vcov_args}{List of additional arguments forwarded to \code{fixest::vcov()}.}
}
\value{
A \code{data.frame} of class \code{"es_result"} with columns:
\itemize{
  \item \code{term}, \code{estimate}, \code{std.error}, \code{statistic}, \code{p.value}
  \item \code{conf_low_XX}, \code{conf_high_XX} (for each requested \code{conf.level})
  \item \code{relative_time} (integer; 0 = event), \code{is_baseline} (logical; classic only)
}
Attributes include: \code{lead_range}, \code{lag_range}, \code{baseline}, \code{interval}, \code{call}, \code{model_formula}, \code{conf.level},
\code{N}, \code{N_units}, \code{N_treated}, \code{N_nevertreated}, \code{fe}, \code{vcov_type}, \code{cluster_vars}, \code{staggered}, \code{sunab_used}.
}
\description{
Runs an event study regression on panel data, supporting both classic (universal timing) and staggered (unit-varying timing via \code{sunab}).
The function builds the design (lead/lag factor or \code{sunab}), estimates with \pkg{fixest}, and returns a tidy table with metadata.
}
\section{Key Features}{

\itemize{
  \item One-step event study: specify outcome, treatment, time, timing, fixed effects, and (optionally) covariates.
  \item Switch between Classic (factor expansion) and Staggered-SAFE (\code{method = "sunab"}).
  \item Flexible clustering, weights, and VCOV choices (e.g., \code{vcov = "HC1" | "HC3" | "CR2" | "iid" ...}).
  \item Automatic lead/lag window detection and customizable baseline period.
  \item Returns an \code{"es_result"} object compatible with \code{print()} and \code{autoplot()}.
}
}

